<h1>Routes View</h1>

<h2>Add a new location</h2>
<%= form_for @location do |f| %>
  <%= f.label :"location name" %>:
  <%= f.text_field :name %><br />
  <%= f.label :"address or coordinates" %>:
  <%= f.text_field :address %><br />
  <% f.hidden_field(:user_id, :value => current_user.id) %>

  <%= f.submit %>
<% end %>

<script>
 // function to get current location from browser
	function getRouteTime(id, address) {
	  if (!navigator.geolocation) {
	    x.innerHTML = "Geolocation is not supported by this browser.";
	    return;
	  }
	  
	  navigator.geolocation.getCurrentPosition(function (position) {
	  	getRouteTime2(id, address, position);
	  });
	}

 // pass generated location and address info to wrapper/api
	function getRouteTime2(id, address, position) {
		$.post("<%= get_data_path %>", {
			address_info: address,
			lat: position.coords.latitude,
			lon: position.coords.longitude
		}, function (data) {
			showRouteTime(id, data);
		});
	}

	// return info to display on appropriate location
	function showRouteTime(id, data) {
		var x = document.getElementById("route_time_" + id);
  	x.innerHTML = data.time;
	}
</script>

<h2>My Locations</h2>
<ul>
	<% @my_locations.each do |location| %>
	<li>
		<%= location.name %>
		<%= location.address %>
		<p>Click the button to get your estimated drive time from your current location.</p>

		<button onclick="getRouteTime(<%= location.id %>, '<%= location.address %>')">Get Route Time</button>

		<p id="route_time_<%= location.id %>"></p>

		<%= button_to "Test API", get_data_path %>
	</li>
	<% end %>
</ul>